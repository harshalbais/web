<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>🌍 Multilingual AI Voice Assistant</title>
  <!-- ✅ Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- ✅ Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>
<body class="bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 min-h-screen flex items-center justify-center font-sans">

  <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-lg text-center">
    
    <h2 class="text-2xl font-bold mb-6 flex items-center justify-center gap-2">
      <i class="bi bi-mic-fill text-purple-600"></i> Multilingual AI Voice Assistant
    </h2>

    <!-- 🌍 Language Selector -->
    <label for="langSelect" class="block text-lg font-medium text-gray-700 mb-2">Choose Language:</label>
    <select id="langSelect" 
            class="w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 mb-6">
      <option value="en-US">English (US)</option>
      <option value="hi-IN">Hindi</option>
      <option value="mr-IN">Marathi</option>
      <option value="fr-FR">French</option>
      <option value="de-DE">German</option>
    </select>

    <!-- 🎙️ Control Buttons -->
    <div class="flex justify-center gap-4 mb-6">
      <button onclick="startRecognition()" 
              class="flex items-center gap-2 bg-green-500 text-white px-6 py-3 rounded-xl hover:bg-green-600 transition shadow-lg">
        <i class="bi bi-play-fill text-xl"></i> Start
      </button>
      <button onclick="stopRecognition()" 
              class="flex items-center gap-2 bg-red-500 text-white px-6 py-3 rounded-xl hover:bg-red-600 transition shadow-lg">
        <i class="bi bi-stop-fill text-xl"></i> Stop
      </button>
    </div>

    <!-- 💬 Chat Display -->
    <div class="bg-gray-100 rounded-xl p-4 h-48 overflow-y-auto text-left shadow-inner">
      <p id="userText" class="mb-3 text-gray-800"></p>
      <p id="aiResponse" class="text-purple-700 font-semibold"></p>
    </div>

  </div>

  <script>
    let recognition;

    // Log voices (debugging)
    speechSynthesis.onvoiceschanged = () => {
      console.log("Available voices:", speechSynthesis.getVoices());
    };

    // 🔊 Speak with fallback
    function speakText(text, lang) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;

      let voices = speechSynthesis.getVoices();
      let voice = voices.find(v => v.lang === lang);
      if (voice) utterance.voice = voice;

      speechSynthesis.speak(utterance);
    }

    function startRecognition() {
      const lang = document.getElementById("langSelect").value;
      recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = lang;
      recognition.continuous = true;
      recognition.interimResults = false;
      recognition.start();

      recognition.onresult = function(event) {
        const lastResultIndex = event.results.length - 1;
        const text = event.results[lastResultIndex][0].transcript;

        // Stop AI voice if user speaks
        if (speechSynthesis.speaking) {
          speechSynthesis.cancel();
        }

        document.getElementById("userText").innerText = "👤 You: " + text;
        sendToFlask(text, lang);
      };

      recognition.onend = function() {
        recognition.start(); // auto-restart
      };
    }

    function stopRecognition() {
      if (recognition) recognition.stop();
    }

    function sendToFlask(text, lang) {
      fetch("/chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ message: text, lang: lang })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("aiResponse").innerText = "🤖 AI: " + data.reply;
        speakText(data.reply, data.lang);
      });
    }
  </script>
</body>
</html>
